<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MoneyVault - Analizador de Presupuesto Personal</title>
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí∞</text></svg>">
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Scripts -->
    <script src="https://unpkg.com/tailwindcss@^3/dist/tailwind.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <style>
        html, body {
            height: 100%;
            font-family: 'Inter', sans-serif;
            background: #0a0a0a;
        }
        
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }
        
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInLeft { from { opacity: 0; transform: translateX(-30px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes slideInRight { from { opacity: 0; transform: translateX(30px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes blurIn { from { opacity: 0; filter: blur(8px); transform: scale(0.95); } to { opacity: 1; filter: blur(0); transform: scale(1); } }
        @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        
        .animate-fade-in-up { animation: fadeInUp 0.8s ease-out forwards; }
        .animate-slide-in-left { animation: slideInLeft 0.8s ease-out forwards; }
        .animate-slide-in-right { animation: slideInRight 0.8s ease-out forwards; }
        .animate-blur-in { animation: blurIn 0.8s ease-out forwards; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-pulse-slow { animation: pulse 2s ease-in-out infinite; }
        .animate-spin-slow { animation: spin 3s linear infinite; }
        
        .delay-100 { animation-delay: 0.1s; }
        .delay-200 { animation-delay: 0.2s; }
        .delay-300 { animation-delay: 0.3s; }
        .delay-400 { animation-delay: 0.4s; }
        .delay-500 { animation-delay: 0.5s; }
        .delay-600 { animation-delay: 0.6s; }
        .delay-700 { animation-delay: 0.7s; }
        .delay-800 { animation-delay: 0.8s; }
        .delay-1000 { animation-delay: 1s; }
        .delay-1200 { animation-delay: 1.2s; }
        
        .initial-hidden { opacity: 0; }
        
        .glow-green { box-shadow: 0 0 20px rgba(34, 197, 94, 0.3); }
        .glow-blue { box-shadow: 0 0 20px rgba(59, 130, 246, 0.3); }
        .glow-purple { box-shadow: 0 0 20px rgba(147, 51, 234, 0.3); }
        .glow-orange { box-shadow: 0 0 20px rgba(249, 115, 22, 0.3); }
        
        .glass { backdrop-filter: blur(20px); background: rgba(17, 17, 17, 0.8); border: 1px solid rgba(255, 255, 255, 0.1); }
        .glass-card { backdrop-filter: blur(10px); background: rgba(23, 23, 23, 0.6); border: 1px solid rgba(255, 255, 255, 0.08); }
        
        .gradient-green { background: linear-gradient(135deg, #22c55e, #16a34a); }
        .gradient-blue { background: linear-gradient(135deg, #3b82f6, #1d4ed8); }
        .gradient-purple { background: linear-gradient(135deg, #9333ea, #7c3aed); }
        .gradient-orange { background: linear-gradient(135deg, #f59e0b, #d97706); }
        .gradient-red { background: linear-gradient(135deg, #ef4444, #dc2626); }
        .gradient-cyan { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        
        .drag-over { border-color: #3b82f6 !important; background: rgba(59, 130, 246, 0.1) !important; }
    </style>
</head>
<body class="bg-black text-white overflow-x-hidden">
    
    <!-- Main Container -->
    <div class="min-h-screen bg-gradient-to-br from-black via-gray-900 to-black p-4 md:p-8">
        <div class="max-w-7xl mx-auto">
            
            <!-- Header -->
            <div class="text-center mb-12 animate-fade-in-up">
                <h1 class="text-4xl md:text-6xl font-bold mb-4 bg-gradient-to-r from-green-400 via-blue-500 to-purple-600 bg-clip-text text-transparent">
                    üí∞ MoneyVault
                </h1>
                <p class="text-gray-400 text-lg md:text-xl">
                    An√°lisis inteligente de tu presupuesto personal
                </p>
                <div class="flex items-center justify-center gap-2 mt-4">
                    <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                    <span class="text-xs text-green-400">Sistema Activo</span>
                </div>
            </div>

            <!-- Upload Section -->
            <div id="uploadSection" class="animate-slide-in-left delay-300 relative max-w-2xl mx-auto mb-12">
                <div class="absolute -inset-4 bg-gradient-to-r from-green-500/20 to-blue-500/20 rounded-3xl blur-lg animate-pulse-slow"></div>
                <div class="relative glass glow-green rounded-3xl p-8">
                    <div class="text-center mb-6">
                        <div class="w-16 h-16 gradient-green rounded-2xl flex items-center justify-center mx-auto mb-4 animate-float">
                            <i data-lucide="upload-cloud" class="w-8 h-8 text-white"></i>
                        </div>
                        <h3 class="text-xl font-semibold mb-2">Sube tu Estado de Cuenta</h3>
                        <p class="text-gray-400 text-sm">
                            Soportamos PDF, Excel y CSV de todos los bancos mexicanos
                        </p>
                    </div>
                    
                    <div id="uploadArea" class="border-2 border-dashed border-gray-600 rounded-2xl p-12 text-center cursor-pointer transition-all duration-300 hover:border-blue-500 hover:bg-blue-500/5">
                        <div class="space-y-4">
                            <div class="text-4xl animate-float delay-500">üìä</div>
                            <div>
                                <p class="text-lg font-medium">Arrastra tu archivo aqu√≠</p>
                                <p class="text-gray-400 text-sm mt-2">o haz clic para seleccionar</p>
                            </div>
                            <div class="flex flex-wrap justify-center gap-2 text-xs text-gray-500">
                                <span class="px-2 py-1 bg-gray-800 rounded">PDF</span>
                                <span class="px-2 py-1 bg-gray-800 rounded">XLSX</span>
                                <span class="px-2 py-1 bg-gray-800 rounded">CSV</span>
                            </div>
                        </div>
                    </div>
                    
                    <input type="file" id="fileInput" class="hidden" accept=".pdf,.xlsx,.xls,.csv">
                    
                    <div class="flex justify-center mt-6">
                        <button onclick="document.getElementById('fileInput').click()" class="px-6 py-3 gradient-blue rounded-xl font-medium hover:scale-105 transition-transform flex items-center gap-2">
                            <i data-lucide="folder-open" class="w-4 h-4"></i>
                            Seleccionar Archivo
                        </button>
                    </div>
                </div>
            </div>

<!-- CONTIN√öA AQU√ç LA SECCI√ìN 2: FORMULARIOS Y ESTADOS -->
            
            <!-- File Selected Section -->
            <div id="fileSection" class="animate-fade-in-up delay-600 relative max-w-2xl mx-auto mb-12 hidden">
                <div class="absolute -inset-4 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-3xl blur-lg animate-pulse-slow"></div>
                <div class="relative glass glow-blue rounded-3xl p-8">
                    <div class="text-center mb-6">
                        <h3 class="text-xl font-semibold mb-2">Archivo Seleccionado</h3>
                        <p class="text-gray-400 text-sm">Listo para procesar</p>
                    </div>
                    
                    <div id="fileInfo" class="glass-card rounded-2xl p-6 mb-6">
                        <!-- File info will be populated here -->
                    </div>
                    
                    <div class="flex flex-col sm:flex-row gap-4 justify-center">
                        <button id="processBtn" onclick="processFile()" class="px-8 py-4 gradient-green rounded-xl font-medium hover:scale-105 transition-transform flex items-center justify-center gap-2">
                            <i data-lucide="play" class="w-4 h-4"></i>
                            Procesar Archivo
                        </button>
                        <button onclick="clearFile()" class="px-6 py-4 glass-card rounded-xl font-medium hover:bg-white/10 transition-all flex items-center justify-center gap-2">
                            <i data-lucide="trash-2" class="w-4 h-4"></i>
                            Eliminar
                        </button>
                    </div>
                </div>
            </div>

            <!-- Loading Section -->
            <div id="loadingSection" class="animate-blur-in relative max-w-2xl mx-auto mb-12 hidden">
                <div class="absolute -inset-4 bg-gradient-to-r from-purple-500/20 to-pink-500/20 rounded-3xl blur-lg animate-pulse-slow"></div>
                <div class="relative glass glow-purple rounded-3xl p-8 text-center">
                    <div class="w-16 h-16 gradient-purple rounded-2xl flex items-center justify-center mx-auto mb-6 animate-spin-slow">
                        <i data-lucide="brain-circuit" class="w-8 h-8 text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2">Analizando tu archivo...</h3>
                    <p class="text-gray-400 text-sm mb-4">
                        Nuestro motor de IA est√° procesando tus transacciones
                    </p>
                    <div class="flex justify-center">
                        <div class="flex space-x-2">
                            <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse"></div>
                            <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse delay-100"></div>
                            <div class="w-2 h-2 bg-purple-400 rounded-full animate-pulse delay-200"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error Section -->
            <div id="errorSection" class="animate-slide-in-right relative max-w-2xl mx-auto mb-12 hidden">
                <div class="absolute -inset-4 bg-gradient-to-r from-red-500/20 to-orange-500/20 rounded-3xl blur-lg"></div>
                <div class="relative glass border-red-500/20 rounded-3xl p-8 text-center">
                    <div class="w-16 h-16 gradient-red rounded-2xl flex items-center justify-center mx-auto mb-6">
                        <i data-lucide="alert-triangle" class="w-8 h-8 text-white"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2 text-red-400">Error al procesar</h3>
                    <p id="errorMessage" class="text-gray-400 text-sm mb-6">
                        <!-- Error message will be populated here -->
                    </p>
                    <button onclick="resetToUpload()" class="px-6 py-3 gradient-blue rounded-xl font-medium hover:scale-105 transition-transform">
                        Intentar de nuevo
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="animate-fade-in-up delay-800 hidden">
                
                <!-- Summary Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                    <div class="glass-card rounded-2xl p-6 hover:bg-white/10 transition-all animate-slide-in-left delay-300">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-12 h-12 gradient-green rounded-xl flex items-center justify-center">
                                <i data-lucide="trending-up" class="w-6 h-6 text-white"></i>
                            </div>
                            <div>
                                <p class="text-xs text-gray-400 uppercase tracking-wider">Ingresos</p>
                                <p class="text-2xl font-semibold" id="totalIngresos">$0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 hover:bg-white/10 transition-all animate-slide-in-left delay-400">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-12 h-12 gradient-red rounded-xl flex items-center justify-center">
                                <i data-lucide="trending-down" class="w-6 h-6 text-white"></i>
                            </div>
                            <div>
                                <p class="text-xs text-gray-400 uppercase tracking-wider">Gastos</p>
                                <p class="text-2xl font-semibold" id="totalExpenses">$0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 hover:bg-white/10 transition-all animate-slide-in-left delay-500">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-12 h-12 gradient-blue rounded-xl flex items-center justify-center">
                                <i data-lucide="piggy-bank" class="w-6 h-6 text-white"></i>
                            </div>
                            <div>
                                <p class="text-xs text-gray-400 uppercase tracking-wider">Ahorro</p>
                                <p class="text-2xl font-semibold" id="ahorroReal">$0</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="glass-card rounded-2xl p-6 hover:bg-white/10 transition-all animate-slide-in-left delay-600">
                        <div class="flex items-center gap-3 mb-4">
                            <div class="w-12 h-12 gradient-purple rounded-xl flex items-center justify-center">
                                <i data-lucide="percent" class="w-6 h-6 text-white"></i>
                            </div>
                            <div>
                                <p class="text-xs text-gray-400 uppercase tracking-wider">% Ahorro</p>
                                <p class="text-2xl font-semibold" id="porcentajeAhorro">0%</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Charts Section -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12">
                    <!-- Pie Chart -->
                    <div class="glass-card rounded-3xl p-8 animate-slide-in-left delay-700">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold">Gastos por Categor√≠a</h3>
                            <div class="flex items-center gap-1">
                                <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                                <span class="text-xs text-green-400">Live</span>
                            </div>
                        </div>
                        <div class="relative h-80">
                            <canvas id="categoryChart"></canvas>
                        </div>
                    </div>

                    <!-- Line Chart -->
                    <div class="glass-card rounded-3xl p-8 animate-slide-in-right delay-800">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold">Tendencia Mensual</h3>
                            <div class="flex items-center gap-2">
                                <i data-lucide="trending-up" class="w-4 h-4 text-blue-400"></i>
                                <span class="text-xs text-blue-400">An√°lisis</span>
                            </div>
                        </div>
                        <div class="relative h-80">
                            <canvas id="trendChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Budget Recommendations -->
                <div class="glass-card rounded-3xl p-8 mb-12 animate-fade-in-up delay-1000">
                    <div class="flex items-center gap-3 mb-6">
                        <div class="w-12 h-12 gradient-purple rounded-xl flex items-center justify-center">
                            <i data-lucide="target" class="w-6 h-6 text-white"></i>
                        </div>
                        <div>
                            <h3 class="text-xl font-semibold">Presupuesto Sugerido</h3>
                            <p class="text-gray-400 text-sm">Optimizaci√≥n inteligente basada en IA</p>
                        </div>
                    </div>
                    
                    <div id="budgetCategories" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Budget items will be populated here -->
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col sm:flex-row gap-4 justify-center animate-fade-in-up delay-1200">
                    <button onclick="resetToUpload()" class="px-8 py-4 glass-card rounded-xl font-medium hover:bg-white/10 transition-all flex items-center justify-center gap-2">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        Analizar Otro Archivo
                    </button>
                    <button onclick="exportResults()" class="px-8 py-4 gradient-cyan rounded-xl font-medium hover:scale-105 transition-transform flex items-center justify-center gap-2">
                        <i data-lucide="download" class="w-4 h-4"></i>
                        Exportar Resultados
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notificationContainer" class="fixed top-4 right-4 z-50 space-y-2">
        <!-- Notifications will be added here -->
    </div>

<!-- CONTIN√öA AQU√ç LA SECCI√ìN 3: JAVASCRIPT PRINCIPAL -->
    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üöÄ MoneyVault - Inicializando...');
            lucide.createIcons();
            initFileHandling();
            
            // PDF.js setup
            if (typeof pdfjsLib !== 'undefined') {
                pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
            }
        });

        // Global variables
        let transactionData = [];
        let categoryChart = null;
        let trendChart = null;
        let selectedFile = null;

        // Categories for analysis
        const categories = {
            'Ingresos': [
                'spei recibido', 'deposito', 'dep√≥sito', 'transferencia recibida', 
                'pago de nomina', 'n√≥mina', 'salario', 'sueldo', 'abono', 'intereses', 
                'rendimiento', 'cashback', 'reembolso', 'devoluci√≥n'
            ],
            'Alimentaci√≥n': [
                'supermercado', 'mercado', 'abarrotes', 'tienda', 'grocery', 
                'soriana', 'walmart', 'chedraui', 'oxxo', 'seven', '7-eleven', 
                'farmacia guadalajara', 'benavides', 'bodega aurrera'
            ],
            'Restaurantes': [
                'restaurante', 'restaurant', 'comida', 'food', 'burger', 'pizza', 'taco', 
                'caf√©', 'coffee', 'bar', 'mc', 'kfc', 'subway', 'dominos', 
                'uber eats', 'rappi', 'didi food', 'starbucks', 'vips'
            ],
            'Transporte': [
                'gasolina', 'gas', 'uber', 'taxi', 'metro', 'autobus', 'parking', 
                'estacionamiento', 'pemex', 'shell', 'bp', 'mobil', 'didi', 'beat'
            ],
            'Entretenimiento': [
                'cine', 'cinema', 'netflix', 'spotify', 'juego', 'game', 'teatro', 
                'concierto', 'club', 'gym', 'deporte', 'cinepolis', 'cinemex'
            ],
            'Servicios': [
                'luz', 'agua', 'gas', 'telefono', 'internet', 'cable', 
                'cfe', 'telmex', 'telcel', 'att', 'movistar', 'izzi', 'sky'
            ],
            'Salud': [
                'farmacia', 'hospital', 'doctor', 'medicina', 'dental', 'laboratorio', 
                'clinica', 'seguro', 'similares', 'issste', 'imss'
            ],
            'Compras': [
                'amazon', 'mercadolibre', 'liverpool', 'palacio', 'sears', 'tienda', 
                'ropa', 'zapatos', 'electronico', 'elektra', 'coppel'
            ],
            'Efectivo': [
                'atm', 'cajero', 'retiro', 'efectivo', 'cash', 'disposicion'
            ],
            'Transferencias': [
                'spei enviado', 'transferencia', 'pago cuenta tercero', 'pago a tercero'
            ],
            'Otros': []
        };

        // File handling functions
        function initFileHandling() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');

            // Drag & drop events
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            uploadArea.addEventListener('click', () => fileInput.click());

            // File selection
            fileInput.addEventListener('change', handleFileSelection);
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('uploadArea').classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('uploadArea').classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.stopPropagation();
            document.getElementById('uploadArea').classList.remove('drag-over');
            
            const files = Array.from(e.dataTransfer.files);
            if (files.length > 0) {
                handleSingleFile(files[0]);
            }
        }

        function handleFileSelection(e) {
            const files = Array.from(e.target.files);
            if (files.length > 0) {
                handleSingleFile(files[0]);
            }
        }

        function handleSingleFile(file) {
            const validExtensions = ['pdf', 'xlsx', 'xls', 'csv'];
            const extension = file.name.split('.').pop().toLowerCase();
            
            if (!validExtensions.includes(extension)) {
                showNotification(`Archivo ${file.name} no v√°lido. Solo PDF, Excel y CSV.`, 'error');
                return;
            }

            selectedFile = {
                file: file,
                name: file.name,
                size: formatFileSize(file.size),
                bank: detectBank(file.name)
            };

            displaySelectedFile();
            showSection('fileSection');
            showNotification('Archivo cargado correctamente', 'success');
        }

        // Utility functions
        function detectBank(fileName) {
            const name = fileName.toLowerCase();
            
            if (name.includes('bbva')) return { name: 'BBVA', logo: 'üè¶', color: 'blue' };
            if (name.includes('santander')) return { name: 'Santander', logo: 'üî¥', color: 'red' };
            if (name.includes('banorte')) return { name: 'Banorte', logo: 'üü†', color: 'orange' };
            if (name.includes('nu')) return { name: 'Nu', logo: 'üíú', color: 'purple' };
            if (name.includes('hsbc')) return { name: 'HSBC', logo: '‚ö™', color: 'gray' };
            if (name.includes('banamex')) return { name: 'Banamex', logo: 'üîµ', color: 'blue' };
            
            return { name: 'Otro Banco', logo: 'üèõÔ∏è', color: 'gray' };
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
                }

        function getFileIcon(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            const icons = { 
                'pdf': 'üìÑ', 
                'xlsx': 'üìä', 
                'xls': 'üìä', 
                'csv': 'üìã' 
            };
            return icons[ext] || 'üìÑ';
        }

        function displaySelectedFile() {
            const fileInfo = document.getElementById('fileInfo');
            const icon = getFileIcon(selectedFile.name);
            
            fileInfo.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-4">
                        <div class="text-3xl">${icon}</div>
                        <div>
                            <p class="font-semibold">${selectedFile.name}</p>
                            <p class="text-sm text-gray-400">${selectedFile.size}</p>
                        </div>
                    </div>
                    <div class="flex items-center gap-2 px-3 py-2 glass-card rounded-lg">
                        <span class="text-lg">${selectedFile.bank.logo}</span>
                        <span class="text-sm font-medium">${selectedFile.bank.name}</span>
                    </div>
                </div>
            `;
        }

        // UI Management functions
        function showSection(sectionId) {
            // Hide all sections
            const sections = ['uploadSection', 'fileSection', 'loadingSection', 'errorSection', 'resultsSection'];
            sections.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.classList.add('hidden');
                }
            });

            // Show target section
            const targetSection = document.getElementById(sectionId);
            if (targetSection) {
                targetSection.classList.remove('hidden');
                targetSection.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        function clearFile() {
            selectedFile = null;
            document.getElementById('fileInput').value = '';
            showSection('uploadSection');
            showNotification('Archivo eliminado', 'success');
        }

        function resetToUpload() {
            // Clear all data
            transactionData = [];
            selectedFile = null;
            
            // Destroy charts
            if (categoryChart) {
                categoryChart.destroy();
                categoryChart = null;
            }
            if (trendChart) {
                trendChart.destroy();
                trendChart = null;
            }
            
            // Reset file input
            document.getElementById('fileInput').value = '';
            
            // Show upload section
            showSection('uploadSection');
            showNotification('Listo para analizar un nuevo archivo', 'success');
        }

        // Notification system
        function showNotification(message, type = 'success') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            
            const bgColors = {
                'success': 'gradient-green',
                'error': 'gradient-red',
                'warning': 'gradient-orange',
                'info': 'gradient-blue'
            };
            
            const icons = {
                'success': 'check-circle',
                'error': 'x-circle',
                'warning': 'alert-triangle',
                'info': 'info'
            };
            
            notification.className = `glass-card rounded-xl p-4 transform translate-x-full transition-transform duration-300 flex items-center gap-3 ${bgColors[type] || 'gradient-blue'}`;
            notification.innerHTML = `
                <i data-lucide="${icons[type] || 'info'}" class="w-5 h-5 text-white"></i>
                <span class="text-white font-medium">${message}</span>
            `;
            
            container.appendChild(notification);
            lucide.createIcons();
            
            // Show notification
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Hide and remove notification
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (container.contains(notification)) {
                        container.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // File processing functions
        async function processFile() {
            if (!selectedFile) {
                showNotification('No hay archivo seleccionado', 'error');
                return;
            }

            showSection('loadingSection');
            
            try {
                const fileExtension = selectedFile.name.split('.').pop().toLowerCase();
                
                if (fileExtension === 'csv') {
                    await processCSV(selectedFile.file);
                } else if (fileExtension === 'xlsx' || fileExtension === 'xls') {
                    await processExcel(selectedFile.file);
                } else if (fileExtension === 'pdf') {
                    await processPDF(selectedFile.file);
                } else {
                    throw new Error('Formato de archivo no soportado');
                }
                
                if (transactionData.length === 0) {
                    throw new Error('No se encontraron transacciones v√°lidas en el archivo');
                }
                
                analyzeData();
                showSection('resultsSection');
                showNotification(`An√°lisis completado: ${transactionData.length} transacciones procesadas`, 'success');
                
            } catch (error) {
                console.error('Error procesando archivo:', error);
                document.getElementById('errorMessage').textContent = error.message;
                showSection('errorSection');
                showNotification('Error al procesar el archivo', 'error');
            }
        }

        // CSV Processing
        async function processCSV(file) {
            const text = await file.text();
            const lines = text.split('\n').filter(line => line.trim());
            
            if (lines.length < 2) {
                throw new Error('El archivo CSV debe tener al menos una l√≠nea de encabezado y una de datos');
            }
            
            const headers = lines[0].split(',').map(h => h.trim().toLowerCase().replace(/"/g, ''));
            transactionData = [];
            
            for (let i = 1; i < lines.length; i++) {
                const values = parseCSVLine(lines[i]);
                const transaction = parseTransaction(headers, values);
                if (transaction) {
                    transactionData.push(transaction);
                }
            }
        }

        function parseCSVLine(line) {
            const result = [];
            let current = '';
            let inQuotes = false;
            
            for (let i = 0; i < line.length; i++) {
                const char = line[i];
                
                if (char === '"') {
                    inQuotes = !inQuotes;
                } else if (char === ',' && !inQuotes) {
                    result.push(current.trim());
                    current = '';
                } else {
                    current += char;
                }
            }
            
            result.push(current.trim());
            return result;
        }

        // Excel Processing
        async function processExcel(file) {
            const data = await file.arrayBuffer();
            const workbook = XLSX.read(data, { type: 'array' });
            const sheetName = workbook.SheetNames[0];
            const worksheet = workbook.Sheets[sheetName];
            const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1 });
            
            if (jsonData.length < 2) {
                throw new Error('El archivo Excel debe tener al menos una l√≠nea de encabezado y una de datos');
            }
            
            const headers = jsonData[0].map(h => String(h || '').trim().toLowerCase());
            transactionData = [];
            
            for (let i = 1; i < jsonData.length; i++) {
                if (jsonData[i] && jsonData[i].length > 0) {
                    const transaction = parseTransaction(headers, jsonData[i]);
                    if (transaction) {
                        transactionData.push(transaction);
                    }
                }
            }
        }

        // PDF Processing
        async function processPDF(file) {
            const arrayBuffer = await file.arrayBuffer();
            const pdf = await pdfjsLib.getDocument(arrayBuffer).promise;
            
            let fullText = '';
            for (let i = 1; i <= pdf.numPages; i++) {
                const page = await pdf.getPage(i);
                const textContent = await page.getTextContent();
                const pageText = textContent.items.map(item => item.str).join(' ');
                fullText += pageText + '\n';
            }
            
            // Detect bank and process accordingly
            if (fullText.includes('BBVA') || fullText.includes('bbva')) {
                await processBBVAPDF(fullText);
            } else if (fullText.includes('Santander') || fullText.includes('SANTANDER')) {
                await processSantanderPDF(fullText);
            } else if (fullText.includes('Nu M√©xico') || fullText.includes('Cuenta Nu')) {
                await processNuPDF(fullText);
            } else if (fullText.includes('Banorte') || fullText.includes('BANORTE')) {
                await processBanortePDF(fullText);
            } else {
                await processGenericPDF(fullText);
            }
        }

        // CONTIN√öA EN SECCI√ìN 5: PROCESADORES ESPEC√çFICOS DE BANCOS
        // Bank-specific PDF processors
        async function processSantanderPDF(text) {
            transactionData = [];
            const lines = text.split('\n');
            
            for (let line of lines) {
                line = line.trim();
                if (line.length < 10) continue;
                
                // Pattern for Santander transactions: Date Description Amount
                const pattern = /(\d{2}-[A-Z]{3}-\d{4})\s+([^$]+)\$\s*([\d,]+\.?\d*)/;
                const match = line.match(pattern);
                
                if (match) {
                    const [_, dateStr, description, amountStr] = match;
                    const amount = parseFloat(amountStr.replace(/,/g, ''));
                    
                    if (!isNaN(amount) && amount > 0) {
                        const transaction = {
                            description: description.trim(),
                            amount: amount,
                            date: parseSantanderDate(dateStr),
                            category: categorizeTransaction(description),
                            type: isIncome(description) ? 'INGRESO' : 'GASTO',
                            source: 'Santander'
                        };
                        transactionData.push(transaction);
                    }
                }
            }
        }

        async function processBBVAPDF(text) {
            transactionData = [];
            const lines = text.split('\n');
            
            for (let line of lines) {
                line = line.trim();
                if (line.length < 10) continue;
                
                // Pattern for BBVA transactions
                const datePattern = /(\d{1,2}\/\d{1,2}\/\d{4})/;
                const amountPattern = /\$?([\d,]+\.?\d*)/;
                
                const dateMatch = line.match(datePattern);
                const amountMatch = line.match(amountPattern);
                
                if (dateMatch && amountMatch) {
                    const amount = parseFloat(amountMatch[1].replace(/,/g, ''));
                    if (!isNaN(amount) && amount > 0) {
                        const description = line
                            .replace(dateMatch[0], '')
                            .replace(amountMatch[0], '')
                            .trim();
                        
                        if (description.length > 3) {
                            const transaction = {
                                description: description,
                                amount: amount,
                                date: new Date(dateMatch[1]),
                                category: categorizeTransaction(description),
                                type: isIncome(description) ? 'INGRESO' : 'GASTO',
                                source: 'BBVA'
                            };
                            transactionData.push(transaction);
                        }
                    }
                }
            }
        }

        async function processNuPDF(text) {
            transactionData = [];
            const lines = text.split('\n');
            
            for (let line of lines) {
                line = line.trim();
                if (line.length < 10) continue;
                
                // Nu Bank usually has simple format
                const pattern = /(\d{1,2}\/\d{1,2})\s+([^$]+)\s+\$?([\d,]+\.?\d*)/;
                const match = line.match(pattern);
                
                if (match) {
                    const [_, dateStr, description, amountStr] = match;
                    const amount = parseFloat(amountStr.replace(/,/g, ''));
                    
                    if (!isNaN(amount) && amount > 0) {
                        const currentYear = new Date().getFullYear();
                        const [day, month] = dateStr.split('/');
                        const date = new Date(currentYear, parseInt(month) - 1, parseInt(day));
                        
                        const transaction = {
                            description: description.trim(),
                            amount: amount,
                            date: date,
                            category: categorizeTransaction(description),
                            type: isIncome(description) ? 'INGRESO' : 'GASTO',
                            source: 'Nu'
                        };
                        transactionData.push(transaction);
                    }
                }
            }
        }

        async function processBanortePDF(text) {
            // Similar to other processors, implement Banorte-specific parsing
            await processGenericPDF(text);
        }

        async function processGenericPDF(text) {
            transactionData = [];
            const lines = text.split('\n');
            
            const datePatterns = [
                /(\d{1,2}\/\d{1,2}\/\d{4})/,
                /(\d{1,2}-\d{1,2}-\d{4})/,
                /(\d{1,2} [A-Z]{3} \d{4})/
            ];
            
            for (let line of lines) {
                line = line.trim();
                if (line.length < 10) continue;
                
                let dateFound = null;
                for (const pattern of datePatterns) {
                    const match = line.match(pattern);
                    if (match) {
                        dateFound = match[1];
                        break;
                    }
                }
                
                if (dateFound && line.includes('$')) {
                    const amountMatch = line.match(/\$?([\d,]+\.?\d*)/);
                    
                    if (amountMatch) {
                        const amount = parseFloat(amountMatch[1].replace(/,/g, ''));
                        if (!isNaN(amount) && amount > 0) {
                            const description = line
                                .replace(dateFound, '')
                                .replace(amountMatch[0], '')
                                .trim();
                            
                            if (description.length > 5) {
                                const transaction = {
                                    description: description,
                                    amount: amount,
                                    date: new Date(dateFound),
                                    category: categorizeTransaction(description),
                                    type: isIncome(description) ? 'INGRESO' : 'GASTO',
                                    source: 'Gen√©rico'
                                };
                                transactionData.push(transaction);
                            }
                        }
                    }
                }
            }
        }

        // Transaction parsing helpers
        function parseTransaction(headers, values) {
            const descriptionFields = ['descripcion', 'descripci√≥n', 'concepto', 'description', 'merchant', 'comercio', 'movimiento'];
            const amountFields = ['monto', 'importe', 'amount', 'cantidad', 'cargo', 'abono', 'importe neto'];
            const dateFields = ['fecha', 'date', 'dia'];
            
            let description = '';
            let amount = 0;
            let date = new Date();
            
            headers.forEach((header, index) => {
                const value = values[index];
                const headerLower = String(header || '').toLowerCase().trim();
                
                if (descriptionFields.some(field => headerLower.includes(field))) {
                    description = String(value || '').replace(/"/g, '');
                }
                
                if (amountFields.some(field => headerLower.includes(field))) {
                    const cleanValue = String(value || '0').replace(/[,$\s"]/g, '');
                    const numValue = parseFloat(cleanValue);
                    if (!isNaN(numValue) && Math.abs(numValue) > Math.abs(amount)) {
                        amount = numValue;
                    }
                }
                
                if (dateFields.some(field => headerLower.includes(field))) {
                    const dateValue = new Date(value);
                    if (dateValue && !isNaN(dateValue.getTime())) {
                        date = dateValue;
                    }
                }
            });
            
            if (description && Math.abs(amount) > 0) {
                return {
                    description: description,
                    amount: Math.abs(amount),
                    date: date,
                    category: categorizeTransaction(description),
                    type: isIncome(description) ? 'INGRESO' : 'GASTO',
                    source: 'CSV/Excel'
                };
            }
            
            return null;
        }

        function parseSantanderDate(dateStr) {
            const parts = dateStr.split('-');
            if (parts.length !== 3) return new Date();
            
            const day = parseInt(parts[0]);
            const monthStr = parts[1];
            const year = parseInt(parts[2]);
            
            const monthMap = {
                'ENE': 0, 'FEB': 1, 'MAR': 2, 'ABR': 3, 'MAY': 4, 'JUN': 5,
                'JUL': 6, 'AGO': 7, 'SEP': 8, 'OCT': 9, 'NOV': 10, 'DIC': 11
            };
            
            const month = monthMap[monthStr];
            return month !== undefined ? new Date(year, month, day) : new Date();
        }

        function isIncome(description) {
            const desc = description.toUpperCase();
            const incomeKeywords = [
                'ABONO', 'DEPOSITO', 'TRANSFERENCIA RECIBIDA', 'PAGO DE NOMINA',
                'N√ìMINA', 'SALARIO', 'SUELDO', 'INTERESES', 'RENDIMIENTO',
                'CASHBACK', 'REEMBOLSO', 'DEVOLUCI√ìN'
            ];
            
            return incomeKeywords.some(keyword => desc.includes(keyword));
        }

        function categorizeTransaction(description) {
            const desc = description.toLowerCase();
            
            for (const [category, keywords] of Object.entries(categories)) {
                if (category === 'Otros') continue;
                
                for (const keyword of keywords) {
                    if (desc.includes(keyword)) {
                        return category;
                    }
                }
            }
            
            return 'Otros';
        }

        // Data analysis functions
        function analyzeData() {
            if (transactionData.length === 0) return;
            
            const ingresos = transactionData.filter(t => t.category === 'Ingresos' || t.type === 'INGRESO');
            const gastos = transactionData.filter(t => t.category !== 'Ingresos' && t.type !== 'INGRESO');
            
            const totalIngresos = ingresos.reduce((sum, t) => sum + t.amount, 0);
            const totalGastos = gastos.reduce((sum, t) => sum + t.amount, 0);
            const ahorroReal = totalIngresos - totalGastos;
            const porcentajeAhorro = totalIngresos > 0 ? ((ahorroReal / totalIngresos) * 100) : 0;
            
            // Update summary cards
            updateElement('totalIngresos', formatCurrency(totalIngresos));
            updateElement('totalExpenses', formatCurrency(totalGastos));
            updateElement('ahorroReal', formatCurrency(ahorroReal));
            updateElement('porcentajeAhorro', `${porcentajeAhorro.toFixed(1)}%`);
            
            // Calculate category totals
            const categoryTotals = {};
            gastos.forEach(t => {
                categoryTotals[t.category] = (categoryTotals[t.category] || 0) + t.amount;
            });
            
            // Create charts
            createCategoryChart(categoryTotals);
            createTrendChart();
            createBudgetSuggestions(categoryTotals, totalGastos, totalIngresos);
            
            console.log('An√°lisis completado:', {
                transacciones: transactionData.length,
                ingresos: totalIngresos,
                gastos: totalGastos,
                ahorro: ahorroReal
            });
        }

        function updateElement(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('es-MX', {
                style: 'currency',
                currency: 'MXN',
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        // Chart creation functions
        function createCategoryChart(categoryTotals) {
            const ctx = document.getElementById('categoryChart');
            if (!ctx) return;
            
            if (categoryChart) {
                categoryChart.destroy();
            }
            
            const labels = Object.keys(categoryTotals);
            const data = Object.values(categoryTotals);
            
            const colors = [
                '#22c55e', '#3b82f6', '#f59e0b', '#ef4444',
                '#8b5cf6', '#06b6d4', '#f97316', '#84cc16',
                '#ec4899', '#64748b'
            ];
            
            categoryChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: colors.slice(0, labels.length),
                        borderWidth: 0,
                        hoverBorderWidth: 4,
                        hoverBorderColor: '#ffffff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                color: '#ffffff',
                                font: {
                                    size: 12
                                }
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#ffffff',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    const value = formatCurrency(context.parsed);
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    cutout: '50%'
                }
            });
        }

        function createTrendChart() {
            const ctx = document.getElementById('trendChart');
            if (!ctx) return;
            
            if (trendChart) {
                trendChart.destroy();
            }
            
            // Group transactions by month
            const monthlyData = {};
            transactionData.forEach(t => {
                if (t.category !== 'Ingresos' && t.type !== 'INGRESO') {
                    const monthKey = t.date.toISOString().substring(0, 7);
                    monthlyData[monthKey] = (monthlyData[monthKey] || 0) + t.amount;
                }
            });
            
            const sortedMonths = Object.keys(monthlyData).sort();
            const monthLabels = sortedMonths.map(month => {
                const date = new Date(month + '-01');
                return date.toLocaleDateString('es-ES', { year: 'numeric', month: 'short' });
            });
            const monthValues = sortedMonths.map(month => monthlyData[month]);
            
            trendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: monthLabels,
                    datasets: [{
                        label: 'Gastos Mensuales',
                        data: monthValues,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#ffffff',
                        pointBorderWidth: 2,
                        pointRadius: 6,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            titleColor: '#ffffff',
                            bodyColor: '#ffffff',
                            borderColor: '#ffffff',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `Gastos: ${formatCurrency(context.parsed.y)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#9ca3af'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#9ca3af',
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    }
                }
            });
        }

        function createBudgetSuggestions(categoryTotals, totalExpenses, totalIngresos) {
            const budgetContainer = document.getElementById('budgetCategories');
            if (!budgetContainer) return;
            
            budgetContainer.innerHTML = '';
            
            // Add financial health summary
            if (totalIngresos > 0) {
                const ratioGastos = ((totalExpenses / totalIngresos) * 100).toFixed(1);
                const ahorroSugerido = totalIngresos * 0.2;
                
                const summaryCard = document.createElement('div');
                summaryCard.className = 'glass-card rounded-2xl p-6 md:col-span-2 lg:col-span-3';
                summaryCard.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div>
                            <h4 class="font-semibold mb-2">üìä Resumen Financiero</h4>
                            <p class="text-sm text-gray-400">
                                Gastas ${ratioGastos}% de tus ingresos
                                ${ratioGastos > 80 ? '‚ö†Ô∏è Riesgo alto' : ratioGastos > 60 ? '‚ö° Moderado' : '‚úÖ Saludable'}
                            </p>
                        </div>
                        <div class="text-right">
                            <p class="text-sm text-gray-400">Ahorro sugerido</p>
                            <p class="text-xl font-semibold text-green-400">${formatCurrency(ahorroSugerido)}</p>
                        </div>
                    </div>
                `;
                budgetContainer.appendChild(summaryCard);
            }
            
            // Add category budget suggestions
            const improvementFactor = 0.9; // 10% reduction target
            
            Object.entries(categoryTotals).forEach(([category, amount]) => {
                const suggestedAmount = Math.round(amount * improvementFactor);
                const percentage = totalExpenses > 0 ? ((amount / totalExpenses) * 100).toFixed(1) : 0;
                const savings = amount - suggestedAmount;
                
                const categoryCard = document.createElement('div');
                categoryCard.className = 'glass-card rounded-2xl p-4 hover:bg-white/10 transition-all';
                categoryCard.innerHTML = `
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-medium">${category}</h4>
                        <span class="text-xs text-gray-400">${percentage}%</span>
                    </div>
                    <div class="space-y-2">
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">Actual:</span>
                            <span>${formatCurrency(amount)}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">Sugerido:</span>
                            <span class="text-green-400">${formatCurrency(suggestedAmount)}</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="text-gray-400">Ahorro:</span>
                            <span class="text-blue-400">${formatCurrency(savings)}</span>
                        </div>
                    </div>
                `;
                
                budgetContainer.appendChild(categoryCard);
            });
        }

        // Export functionality
        function exportResults() {
            if (transactionData.length === 0) {
                showNotification('No hay datos para exportar', 'warning');
                return;
            }
            
            const exportData = {
                fecha_analisis: new Date().toISOString(),
                archivo_procesado: selectedFile ? selectedFile.name : 'Desconocido',
                resumen: {
                    total_transacciones: transactionData.length,
                    total_ingresos: transactionData.filter(t => t.category === 'Ingresos' || t.type === 'INGRESO').reduce((sum, t) => sum + t.amount, 0),
                    total_gastos: transactionData.filter(t => t.category !== 'Ingresos' && t.type !== 'INGRESO').reduce((sum, t) => sum + t.amount, 0)
                },
                transacciones: transactionData.map(t => ({
                    fecha: t.date.toISOString().split('T')[0],
                    descripcion: t.description,
                    monto: t.amount,
                    categoria: t.category,
                    tipo: t.type,
                    fuente: t.source || 'Desconocido'
                })),
                categorias: transactionData.reduce((acc, t) => {
                    if (t.category !== 'Ingresos' && t.type !== 'INGRESO') {
                        acc[t.category] = (acc[t.category] || 0) + t.amount;
                    }
                    return acc;
                }, {})
            };
            
            const blob = new Blob([JSON.stringify(exportData, null, 2)], { 
                type: 'application/json' 
            });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `analisis-presupuesto-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showNotification('Resultados exportados correctamente', 'success');
        }

        // Initialize animations when sections become visible
        function initAnimations() {
            setTimeout(() => {
                document.querySelectorAll('.initial-hidden').forEach((el, index) => {
                    setTimeout(() => {
                        el.classList.remove('initial-hidden');
                    }, index * 100);
                });
            }, 100);
        }

        // Call initialization
        initAnimations();

        // Debug helpers
        window.debugApp = {
            showTransactionData: () => console.table(transactionData),
            showCategories: () => console.log(categories),
            testNotification: (type) => showNotification(`Test ${type} notification`, type),
            resetApp: resetToUpload
        };

        console.log('üí∞ MoneyVault inicializado correctamente');
        console.log('Usa window.debugApp para funciones de depuraci√≥n');
    </script>
</body>
</html>
